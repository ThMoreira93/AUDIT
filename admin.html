<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AUDIT – Auditoria de Viagens</title>
  <link rel="icon" type="image/png" href="favicon.png">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <style>
    :root {
      --primary: #6D28D9;
      --primary-hover: #5B21B6;
      --primary-light: #EDE9FE;
      --bg-main: #F8FAFC;
      --bg-card: #FFFFFF;
      --text-main: #1E293B;
      --text-muted: #64748B;
      --border: #E2E8F0;
      --success: #10B981;
      --danger: #EF4444;
      --warning: #F59E0B;
      --overlay: rgba(15, 23, 42, 0.95);
    }
    * { box-sizing: border-box; -webkit-font-smoothing: antialiased; }
    body { margin: 0; background: var(--bg-main); font-family: 'Inter', sans-serif; color: var(--text-main); min-height: 100vh; }
    @media print {
      @page { size: landscape; margin: 5mm; }
      body > *:not(#printArea) { display: none !important; }
      #printArea { display: block !important; position: absolute; left: 0; top: 0; width: 100%; background: white; padding: 0; }
      table { width: 100%; border-collapse: collapse; margin-top: 10px; }
      th, td { border: 1px solid #000; padding: 4px 6px; font-size: 8pt; text-align: left; }
      th { background: #eee !important; -webkit-print-color-adjust: exact; }
    }
    #printArea { display: none; padding: 20px; }
    header.top-bar {
      background: #1E1B4B; color: white; height: 70px; padding: 0 30px;
      display: flex; align-items: center; justify-content: space-between;
      position: sticky; top: 0; z-index: 1000; box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }
    .brand { display: flex; align-items: center; gap: 12px; font-weight: 800; font-size: 20px; }
    .brand .logo { width: 38px; height: 38px; background: var(--primary); border-radius: 10px; display: flex; align-items: center; justify-content: center; }
    nav.nav-links { display: flex; height: 100%; margin-left: 20px; }
    nav.nav-links a {
      display: flex; align-items: center; padding: 0 18px; color: #94A3B8; text-decoration: none;
      font-weight: 600; font-size: 14px; border-bottom: 3px solid transparent; transition: 0.2s;
    }
    nav.nav-links a:hover { color: white; background: rgba(255,255,255,0.05); }
    nav.nav-links a.active { color: white; border-bottom-color: var(--primary); background: rgba(109, 40, 217, 0.1); }
    .user-actions { display: flex; align-items: center; gap: 15px; }
    .btn-logout { background: #EF4444; color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 700; }
    .app-content { max-width: 1600px; margin: 30px auto; padding: 0 20px; }
    .card { background: #fff; border-radius: 20px; padding: 25px; border: 1px solid var(--border); margin-bottom: 25px; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
    .card h3 { margin: 0 0 20px; font-size: 17px; font-weight: 800; display: flex; align-items: center; gap: 10px; }
    .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 25px; }
    .kpi-card { padding: 22px; border-radius: 18px; background: white; border: 1px solid var(--border); display: flex; flex-direction: column; gap: 5px; }
    .kpi-label { font-size: 11px; font-weight: 700; color: var(--text-muted); text-transform: uppercase; }
    .kpi-value { font-size: 26px; font-weight: 900; }
    .table-responsive { width: 100%; overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; }
    th { text-align: left; padding: 14px 10px; background: #F8FAFC; font-size: 10px; font-weight: 700; color: var(--text-muted); text-transform: uppercase; border-bottom: 2px solid var(--border); }
    td { padding: 12px 10px; border-bottom: 1px solid var(--border); font-size: 12px; vertical-align: top; }
    .pill { padding: 4px 8px; border-radius: 8px; font-size: 10px; font-weight: 700; text-transform: uppercase; }
    .pill.ok { background: #DCFCE7; color: #166534; }
    .pill.bad { background: #FEE2E2; color: #991B1B; }
    .pill.wait { background: #FEF3C7; color: #92400E; }
    .input, select { padding: 10px 14px; border: 1.5px solid var(--border); border-radius: 10px; font-size: 13px; outline: none; transition: 0.2s; background: white; width: 100%; }
    .btn { padding: 10px 20px; border: none; border-radius: 10px; font-weight: 700; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; font-size: 14px; }
    .btn-primary { background: var(--primary); color: white; }
    .btn-danger { background: var(--danger); color: white; }
    .btn-light { background: white; border: 1.5px solid var(--border); color: var(--text-main); }
    .modal-overlay { position: fixed; inset: 0; background: var(--overlay); display: none; align-items: center; justify-content: center; z-index: 2000; backdrop-filter: blur(8px); }
    .modal-content { background: white; width: 95%; max-width: 1100px; padding: 35px; border-radius: 24px; max-height: 90vh; overflow: hidden; display: flex; flex-direction: column; }
    .spreadsheet-wrap { flex: 1; overflow: auto; border: 1px solid var(--border); border-radius: 12px; background: #f1f5f9; margin: 20px 0; }
    .sheet-table { width: 100%; border-collapse: separate; border-spacing: 0; background: white; table-layout: fixed; }
    .sheet-table th { position: sticky; top: 0; background: #e2e8f0; z-index: 10; border: 1px solid #cbd5e1; font-size: 11px; padding: 8px; text-align: center; }
    .sheet-table td { border: 1px solid #e2e8f0; padding: 0; overflow: hidden; }
    .sheet-table .cell { min-height: 35px; padding: 8px; outline: none; font-size: 13px; white-space: nowrap; }
    .sheet-table .cell:focus { background: var(--primary-light); box-shadow: inset 0 0 0 2px var(--primary); }
    .sheet-table .row-num { width: 40px; background: #f8fafc; text-align: center; font-weight: bold; color: #94a3b8; font-size: 11px; border: 1px solid #cbd5e1; }
    .login-screen { min-height: 100vh; display: flex; align-items: center; justify-content: center; background: #1E1B4B; }
    .login-card { background: white; padding: 45px; border-radius: 30px; width: 100%; max-width: 400px; box-shadow: 0 25px 50px rgba(0,0,0,0.5); }
    .toast{position:fixed; left:50%; top:18px; transform:translateX(-50%) translateY(-14px); background:#10B981; color:#fff; padding:10px 14px; border-radius:10px; opacity:0; box-shadow:0 10px 24px rgba(0,0,0,.2); font-weight:800; z-index:3000; transition:.25s}
    .toast.show{opacity:1; transform:translateX(-50%) translateY(0)}
    .toast.error{background:#EF4444}
    .mode-bar{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:0 0 14px}
    .mode-card{background:#fff;border:2px solid var(--border);border-radius:18px;padding:16px;display:flex;align-items:center;gap:12px;cursor:pointer;transition:.2s;box-shadow:0 8px 18px rgba(2,6,23,.06)}
    .mode-card:hover{transform:translateY(-1px)}
    .mode-card.active{border-color:var(--primary);box-shadow:0 0 0 4px var(--primary-light)}
    .mode-card i{font-size:22px;color:var(--primary)}
    .mode-title{font-weight:900}
    .mode-desc{font-size:12px;color:var(--text-muted);margin-top:2px}
    .mode-switch{display:flex;justify-content:flex-end;margin:-6px 0 18px}
    .mode-switch .btn-switch{background:#fff;color:var(--primary);border:2px solid var(--primary);padding:8px 12px;border-radius:12px;font-weight:900;cursor:pointer;display:flex;align-items:center;gap:8px}
    .mode-switch .btn-switch:hover{background:var(--primary-light)}
    .hidden{display:none !important}
    .he-filter-grid{display:grid;grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));gap:14px;align-items:end}
    .he-filter-grid label{display:block;font-size:11px;font-weight:800;color:var(--text-muted);text-transform:uppercase;margin-bottom:6px}
    .he-filter-grid .input{height:42px;border-radius:12px}
    #tab-heDash select[multiple]{height:100px !important;padding:10px 12px;border-radius:12px}
  </style>
</head>
<body>
  <div id="printArea">
    <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:2px solid #000; padding-bottom:10px; margin-bottom:15px">
      <div style="font-weight:800; font-size:20px; color:#6D28D9"><i class="fa-solid fa-route"></i> AUDIT</div>
      <div id="pDate" style="font-size:10px"></div>
    </div>
    <h2 id="pTitle" style="margin:0; font-size:16px">Relatório de Lançamentos Viagens</h2>
    <p id="pSub" style="margin:5px 0 15px 0; font-weight:bold; font-size:12px"></p>
    <div id="pContainer"></div>
    <div style="text-align:right; margin-top:20px; border-top:2px solid #000; padding-top:10px">
      <h3 style="font-size:14px">Soma Total Aprovada: <span id="pTotalValue">R$ 0,00</span></h3>
    </div>
  </div>

  <div id="loginScreen" class="login-screen">
    <div class="login-card">
      <div style="text-align:center; margin-bottom:30px">
        <div style="width:60px; height:60px; background:var(--primary); color:white; border-radius:15px; display:flex; align-items:center; justify-content:center; font-size:28px; margin:0 auto 7px"><i class="fa-solid fa-route"></i></div>
        <h2 style="margin:0; font-weight:800">AUDIT</h2>
        <p style="color:var(--text-muted); font-size:13px; margin-top:1px">Auditoria de Viagens</p>
      </div>
      <div style="display:grid; gap:18px">
        <input id="email" class="input" placeholder="E-mail corporativo"/>
        <input id="senha" type="password" class="input" placeholder="Sua senha"/>
        <div style="text-align:left; margin-top:-8px"><a id="recSenha" style="color:#6D28D9; font-weight:700; font-size:13px; cursor:pointer">Recuperar senha</a></div>
        <button id="btnLogin" class="btn btn-primary" style="justify-content:center; padding:14px 22px; border-radius:16px; background:#7C3AED; font-size:15px">Entrar no Sistema</button>
        <div id="loginMsg" style="text-align:center; color:var(--danger); font-size:13px"></div>
      </div>
    </div>
  </div>

  <div id="appShell" style="display:none">
    <header class="top-bar">
      <div class="brand"><div class="logo"><i class="fa-solid fa-route"></i></div> <span>AUDIT</span></div>
      <nav class="nav-links" id="nav">
        <a href="#dash" data-tab="dash" class="active"><i class="fa-solid fa-chart-pie"></i> Dashboard</a>
        <a href="#lanca" data-tab="lanca"><i class="fa-solid fa-table-list"></i> Lançamentos</a>
        <a href="#mass" data-tab="mass"><i class="fa-solid fa-bolt"></i> Massa</a>
        <a href="#veic" data-tab="veic"><i class="fa-solid fa-car"></i> Veículos</a>
        <a href="#heDash" data-tab="heDash" id="navHeDash" style="display:none"><i class="fa-solid fa-chart-simple"></i> HE Dashboard</a>
        <a href="#heLanca" data-tab="heLanca" id="navHeLanca" style="display:none"><i class="fa-solid fa-list-check"></i> HE Lançamentos</a>
      </nav>
      <div class="user-actions">
        <div style="text-align:right; font-size:12px">
          <div id="userBox" style="font-weight:700">Laura Bispo Moreira</div>
          <div id="userRole" style="color:#94A3B8; font-weight:700; text-transform:uppercase">Acesso</div>
        </div>
        <button id="btnLogout" class="btn-logout"><i class="fa-solid fa-power-off"></i></button>
      </div>
    </header>

    <main class="app-content">
      <div class="mode-bar" id="modeBar">
        <div class="mode-card active" id="mViagem" role="button">
          <i class="fa-solid fa-route"></i>
          <div><div class="mode-title">AUDITORIA DE VIAGENS</div><div class="mode-desc">Dashboard, lançamentos, massa e veículos</div></div>
        </div>
        <div class="mode-card" id="mHE" role="button">
          <i class="fa-solid fa-business-time"></i>
          <div><div class="mode-title">CONTROLE DE HORA EXTRA</div><div class="mode-desc">Aprovação + BI de HE</div></div>
        </div>
      </div>
      <div class="mode-switch"><button class="btn-switch" id="btnModeSwitch" type="button"><i class="fa-solid fa-repeat"></i> Alternar Módulo</button></div>

      <!-- SEÇÃO VIAGENS -->
      <section id="tab-dash">
        <div class="card">
          <h3><i class="fa-solid fa-filter"></i> Filtros Dashboard (BI)</h3>
          <div class="he-filter-grid">
            <div><label>INÍCIO</label><input type="date" class="input" id="dFiltroIni"></div>
            <div><label>FIM</label><input type="date" class="input" id="dFiltroFim"></div>
            <div><label>STATUS</label><select id="dFiltroStatus" class="input"><option value="">Todos</option><option>Pendente</option><option>Aprovado</option><option>Reprovado</option></select></div>
            <div style="display:flex; gap:10px">
              <button class="btn btn-primary" id="btnAplicaDash" style="flex:1">Atualizar Gráficos</button>
              <button class="btn btn-light" id="btnExportDash" title="Excel"><i class="fa-solid fa-file-excel"></i></button>
              <button class="btn btn-light" id="btnLimpaDash"><i class="fa-solid fa-rotate"></i></button>
            </div>
          </div>
        </div>
        <div class="kpi-grid">
          <div class="kpi-card"><span class="kpi-label">Lançamentos</span><span class="kpi-value" id="kTotal">0</span></div>
          <div class="kpi-card" style="border-left: 4px solid var(--success)"><span class="kpi-label">Aprovados</span><span class="kpi-value" id="kAprov" style="color:var(--success)">0</span></div>
          <div class="kpi-card" style="border-left: 4px solid var(--warning)"><span class="kpi-label">Pendentes</span><span class="kpi-value" id="kPend" style="color:var(--warning)">0</span></div>
          <div class="kpi-card" style="border-left: 4px solid var(--primary)"><span class="kpi-label">Total Aprovado</span><span class="kpi-value" id="kVal">R$ 0,00</span></div>
        </div>
        <div class="card"><h3>Distribuição por Status</h3><div style="height:200px"><canvas id="chStatus"></canvas></div></div>
        <div class="card"><h3>Top 10 Colaboradores (R$)</h3><div style="height:100px"><canvas id="chTop"></canvas></div></div>
        <div class="card"><h3>Ranking Completo Aprovados</h3><div id="tblRankContainer" class="table-responsive"></div></div>
      </section>

      <section id="tab-lanca" style="display:none">
        <div class="card">
          <div class="he-filter-grid">
            <div><label>DATA INICIAL</label><input type="date" class="input" id="lFiltroIni"></div>
            <div><label>DATA FINAL</label><input type="date" class="input" id="lFiltroFim"></div>
            <div><label>COLABORADOR</label><select id="lFiltroColab" class="input"><option value="">Todos</option></select></div>
            <div style="display:flex; gap:10px">
              <button class="btn btn-primary" id="btnAplicaLanca" style="flex:1">Filtrar Lançamentos</button>
              <button class="btn btn-light" id="btnLimpaLanca"><i class="fa-solid fa-eraser"></i></button>
              <button class="btn btn-light" id="btnImprimir"><i class="fa-solid fa-print"></i></button>
              <button class="btn btn-light" id="btnExport" title="Excel"><i class="fa-solid fa-file-excel"></i></button>
            </div>
          </div>
        </div>
        <div class="card"><div id="tblLancaContainer" class="table-responsive"></div></div>
      </section>

      <!-- SEÇÃO HORA EXTRA -->
      <section id="tab-heDash" style="display:none">
        <div class="card">
          <h3><i class="fa-solid fa-filter"></i> Filtros – Hora Extra</h3>
          <div class="he-filter-grid">
            <div><label>Início</label><input type="date" class="input" id="heFiltroIni"></div>
            <div><label>Fim</label><input type="date" class="input" id="heFiltroFim"></div>
            <div><label>Status</label><select id="heFiltroStatus" class="input"><option value="">Todos</option><option>Pendente</option><option>Aprovado</option><option>Reprovado</option></select></div>
            <div><label>Acionado Por</label><select id="heFiltroAcionado" class="input"><option value="">Todos</option><option>EDINALDO</option><option>MARCOS</option><option>THIAGO</option><option>CAMILA</option><option>FARAH</option><option>WANDERSON</option></select></div>
            <div><label>Autorizado Supervisor</label><select id="heFiltroAutorizado" class="input"><option value="">Todos</option><option>SIM</option><option>NÃO</option></select></div>
            <div><label>Tipo HE</label><select id="heFiltroTipo" class="input" multiple size="3"><option>feriado</option><option>final de semana</option><option>folga do meio</option><option>dia de turno</option></select></div>
            <div>
              <label>Faixas</label>
              <div style="display:grid; gap:4px; font-size:11px">
                <label><input type="checkbox" id="heR10" checked> 10-15</label>
                <label><input type="checkbox" id="heR16" checked> 16-30</label>
                <label><input type="checkbox" id="heR31" checked> 31-60</label>
              </div>
            </div>
            <div style="display:flex; gap:10px">
              <button class="btn btn-primary" id="btnAplicaHE" style="flex:1">Atualizar Gráficos</button>
              <button class="btn btn-light" id="btnExportHE" title="Excel"><i class="fa-solid fa-file-excel"></i></button>
              <button class="btn btn-light" id="btnLimpaHE"><i class="fa-solid fa-rotate"></i></button>
            </div>
          </div>
        </div>
        <div class="kpi-grid">
          <div class="kpi-card"><span class="kpi-label">Total de Solicitações HE</span><span class="kpi-value" id="kheTotal">0</span></div>
          <div class="kpi-card" style="border-left: 4px solid var(--success)"><span class="kpi-label">Horas Totais</span><span class="kpi-value" id="kheAprov" style="color:var(--success)">0h 00m</span></div>
          <div class="kpi-card" style="border-left: 4px solid var(--warning)"><span class="kpi-label">Solicitações Pendentes</span><span class="kpi-value" id="khePend" style="color:var(--warning)">0</span></div>
        </div>
        <div style="display:grid; grid-template-columns: 1.3fr 1fr 1fr; gap:20px">
          <div class="card"><h3><i class="fa-solid fa-ranking-star"></i> Ranking de Horas</h3><div id="heRankTbl" class="table-responsive"></div></div>
          <div class="card"><h3><i class="fa-solid fa-chart-pie"></i>Tipo de HE</h3><div style="height:260px"><canvas id="heChartTipo"></canvas></div></div>
          <div class="card"><h3><i class="fa-solid fa-chart-pie"></i>Faixas</h3><div style="height:260px"><canvas id="heChartFaixa"></canvas></div></div>
        </div>
      </section>

      <section id="tab-heLanca" style="display:none">
        <div class="card">
          <h3><i class="fa-solid fa-filter"></i> Filtros – Lançamentos HE</h3>
          <div class="he-filter-grid">
            <div><label>COLABORADOR</label><select id="heLFiltroColab" class="input"><option value="">Todos</option></select></div>
            <div><label>DATA INICIAL</label><input type="date" class="input" id="heLFiltroIni"></div>
            <div><label>DATA FINAL</label><input type="date" class="input" id="heLFiltroFim"></div>
            <div><label>STATUS</label><select id="heLFiltroStatus" class="input"><option value="">Todos</option><option>Pendente</option><option>Aprovado</option><option>Reprovado</option></select></div>
            <div><label>ACIONADO POR</label><select id="heLFiltroAcionado" class="input"><option value="">Todos</option><option>EDINALDO</option><option>MARCOS</option><option>THIAGO</option><option>CAMILA</option><option>FARAH</option><option>WANDERSON</option></select></div>
            <div><label>AUTORIZADO?</label><select id="heLFiltroAutorizado" class="input"><option value="">Todos</option><option>SIM</option><option>NÃO</option></select></div>
            <div style="display:flex; gap:10px">
              <button class="btn btn-primary" id="btnAplicaHEList" style="flex:1">Filtrar</button>
              <button class="btn btn-light" id="btnLimpaHEList"><i class="fa-solid fa-eraser"></i></button>
              <button class="btn btn-light" id="btnExportHEList" title="Excel"><i class="fa-solid fa-file-excel"></i></button>
            </div>
          </div>
        </div>
        <div class="card"><div id="heListaTbl" class="table-responsive"></div></div>
      </section>

      <!-- GESTÃO EM MASSA / VEÍCULOS -->
      <section id="tab-mass" style="display:none">
        <div class="card" style="text-align:center; padding:80px">
          <i class="fa-solid fa-bolt fa-4x" style="color:var(--primary); margin-bottom:20px"></i>
          <h2>Ação em Massa</h2>
          <button class="btn btn-primary" onclick="openSpreadsheet('mass')">Abrir Planilha de Status</button>
        </div>
      </section>
      <section id="tab-veic" style="display:none">
        <div style="display:grid; grid-template-columns: 1fr 2.5fr; gap:25px">
          <div class="card" style="text-align:center">
            <i class="fa-solid fa-car fa-3x" style="color:var(--primary); margin-bottom:15px"></i>
            <h3>Gestão de Frota</h3>
            <button class="btn btn-primary" style="width:100%" onclick="openSpreadsheet('veic')">Abrir Planilha de Veículos</button>
          </div>
          <div class="card"><div id="tblVeicContainer" class="table-responsive"></div></div>
        </div>
      </section>
    </main>
  </div>

  <div id="modalEdit" class="modal-overlay">
    <div class="modal-content" style="max-width:600px"><h2 id="editTitle">Editar Registro</h2><div id="editBody" style="display:grid; gap:15px; margin-top:15px"></div><div style="margin-top:25px; display:flex; gap:10px; justify-content:flex-end"><button class="btn btn-light" onclick="closeEdit()">Fechar</button><button class="btn btn-primary" id="btnSaveEdit">Gravar</button></div></div>
  </div>

  <div id="modalConfirm" class="modal-overlay">
    <div class="modal-content" style="max-width:400px; text-align:center"><i class="fa-solid fa-triangle-exclamation fa-4x" style="color:var(--danger)"></i><h3 id="confirmTitle">Confirmar?</h3><p id="confirmMsg"></p><div style="margin-top:25px; display:flex; gap:10px; justify-content:center"><button class="btn btn-light" onclick="closeConfirm()">Cancelar</button><button class="btn btn-danger" id="btnDeleteConfirm">Sim, Excluir</button></div></div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
  
  <script>
    const firebaseConfig = {"apiKey":"AIzaSyBMtXm9wInJb9xrBFU5gyEIMKuWuVzknSU","authDomain":"deslocamento-3bcd0.firebaseapp.com","projectId":"deslocamento-3bcd0","storageBucket":"deslocamento-3bcd0.firebasestorage.app","messagingSenderId":"1041622437635","appId":"1:1041622437635:web:9a0e8b026879919676e336","measurementId":"G-JKWV37MFHB"};
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const $ = (id) => document.getElementById(id);
    Chart.register(ChartDataLabels);

    let cacheSolic = [], cacheVeic = [], cacheHE = [], userProfile = null;
    let unsubSolic = null, unsubVeic = null, unsubHE = null;
    let filterD = { ini: null, fim: null, status: '' };
    let filterL = { ini: null, fim: null, colab: '' };
    let filterHE = { ini: null, fim: null, tipos: [], acionado: '', autorizado: '', status:'', r10:true, r16:true, r31:true };
    let filterHEList = { ini: null, fim: null, colab: '', status: '', acionado: '', autorizado: '' };

    auth.onAuthStateChanged(async (user) => {
      if(user) {
        $('loginScreen').style.display = 'none';
        $('appShell').style.display = 'block';
        const doc = await db.collection('usuarios').doc(user.uid).get();
        userProfile = doc.exists ? doc.data() : { nome: user.email, cargo: 'gestor' };
        $('userBox').textContent = userProfile.nome;
        $('userRole').textContent = userProfile.funcao || userProfile.cargo || 'GESTOR';
        initApp();
        setModo('viagem');
      } else {
        $('loginScreen').style.display = 'flex';
        $('appShell').style.display = 'none';
      }
    });

    $('btnLogin').onclick = async () => {
      const e = $('email').value, s = $('senha').value;
      try { await auth.signInWithEmailAndPassword(e, s); } catch(err) { $('loginMsg').textContent = "Acesso negado."; }
    };
    $('btnLogout').onclick = () => auth.signOut();

    function initApp() {
      document.querySelectorAll('#nav a').forEach(t => {
        t.onclick = (e) => {
          e.preventDefault();
          document.querySelectorAll('#nav a').forEach(x => x.classList.remove('active'));
          t.classList.add('active');
          document.querySelectorAll('main section').forEach(s => s.style.display = 'none');
          $('tab-' + t.dataset.tab).style.display = 'block';
        }
      });
      if(unsubSolic) unsubSolic();
      unsubSolic = db.collection('solicitacoes_diaria').orderBy('createdAt', 'desc').onSnapshot(snap => {
        cacheSolic = snap.docs.map(d => ({ _id: d.id, ...d.data() }));
        populateFilters(); renderDash(); renderLanca();
      });
      if(unsubVeic) unsubVeic();
      unsubVeic = db.collection('veiculos').onSnapshot(snap => {
        cacheVeic = snap.docs.map(d => ({ _id: d.id, ...d.data() }));
        renderVeiculos();
      });
      if(unsubHE) unsubHE();
      unsubHE = db.collection('solicitacoes_hora_extra').onSnapshot(snap => {
        cacheHE = snap.docs.map(d => ({ _id: d.id, ...d.data() }));
        cacheHE.sort((a,b) => (b.createdAt||0) - (a.createdAt||0));
        populateHEFilters(); renderHE(); renderHELista();
      });
    }

    function brl(v) { return Number(v || 0).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }); }

    function formatHours(min) {
        const h = Math.floor(min / 60);
        const m = min % 60;
        return `${h}h ${m.toString().padStart(2, '0')}m`;
    }

    function runFilter(data, f) {
      return data.filter(x => {
        if(f.status && x.status !== f.status) return false;
        if(f.colab && x.colaborador !== f.colab) return false;
        if(f.ini || f.fim) {
          let recordDate = x.createdAt ? new Date(x.createdAt) : new Date(x.dataSaida + "T12:00:00");
          recordDate.setHours(0,0,0,0);
          if(f.ini && recordDate.getTime() < new Date(f.ini + "T00:00:00").getTime()) return false;
          if(f.fim && recordDate.getTime() > new Date(f.fim + "T23:59:59").getTime()) return false;
        }
        return true;
      });
    }

    function runFilterHE(data, f) {
      return data.filter(x=>{
        if(f.ini || f.fim){
          const t = new Date((x.data||'') + 'T00:00:00').getTime();
          if(f.ini && t < new Date(f.ini+'T00:00:00').getTime()) return false;
          if(f.fim && t > new Date(f.fim+'T23:59:59').getTime()) return false;
        }
        if(f.tipos && f.tipos.length && !f.tipos.includes(x.tipoHoraExtra)) return false;
        if(f.acionado && x.acionadoPor !== f.acionado) return false;
        if(f.autorizado && (x.autorizadoSupervisor||'').toUpperCase() !== f.autorizado) return false;
        if(f.status && (x.status||'Pendente') !== f.status) return false;
        if(x.faixaMinutos==='10-15' && !f.r10) return false;
        if(x.faixaMinutos==='16-30' && !f.r16) return false;
        if(x.faixaMinutos==='31-60' && !f.r31) return false;
        return true;
      });
    }

    function runFilterHEList(data, f) {
      return data.filter(x => {
        if(f.colab && x.colaborador !== f.colab) return false;
        if(f.status && (x.status || 'Pendente') !== f.status) return false;
        if(f.acionado && x.acionadoPor !== f.acionado) return false;
        if(f.autorizado && (x.autorizadoSupervisor || '').toUpperCase() !== f.autorizado) return false;
        if(f.ini || f.fim) {
          let t = new Date((x.data || '') + "T12:00:00").getTime();
          if(f.ini && t < new Date(f.ini + "T00:00:00").getTime()) return false;
          if(f.fim && t > new Date(f.fim + "T23:59:59").getTime()) return false;
        }
        return true;
      });
    }

    function renderDash() {
      const d = runFilter(cacheSolic, filterD);
      const aprov = d.filter(x => x.status === 'Aprovado');
      $('kTotal').textContent = d.length;
      $('kAprov').textContent = aprov.length;
      $('kPend').textContent = d.filter(x => x.status === 'Pendente').length;
      $('kVal').textContent = brl(aprov.reduce((s, x) => s + (x.valor || 0), 0));
      
      const sMap = { Pendente:0, Aprovado:0, Reprovado:0 };
      d.forEach(x => sMap[x.status]++);
      const cMap = {};
      aprov.forEach(x => { cMap[x.colaborador] = (cMap[x.colaborador]||0) + (x.valor||0); });
      const sorted = Object.entries(cMap).map(([k,v])=>({k,v})).sort((a,b)=>b.v-a.v);
      const rRows = sorted.map((r, i) => `<tr><td style="width:50px; font-weight:800">${i+1}º</td><td><b>${r.k}</b></td><td style="text-align:right">${brl(r.v)}</td></tr>`).join('');
      $('tblRankContainer').innerHTML = `<table><thead><tr><th>POS</th><th>COLABORADOR</th><th style="text-align:right">APROVADO</th></tr></thead><tbody>${rRows || '<tr><td colspan="3">Vazio</td></tr>'}</tbody></table>`;
      try {
        if(window._c1) window._c1.destroy();
        if(window._c2) window._c2.destroy();
        window._c1 = new Chart($('chStatus'), { type:'doughnut', data: { labels: Object.keys(sMap), datasets:[{ data: Object.values(sMap), backgroundColor:['#F59E0B','#10B981','#EF4444'], borderWidth: 0 }] }, options: { maintainAspectRatio:false, cutout:'70%', plugins: { legend: { position: 'right' }, datalabels: { color: '#fff', font: { weight: 'bold' } } } } });
        const top10 = sorted.slice(0, 10);
        window._c2 = new Chart($('chTop'), { type:'bar', data: { labels: top10.map(x => x.k), datasets: [{ label:'R$', data: top10.map(x => x.v), backgroundColor:'#6D28D9', borderRadius: 6 }] }, options: { indexAxis: 'y', maintainAspectRatio:false, plugins: { legend: { display: false }, datalabels: { anchor:'end', align:'end', color:'#1E293B', font:{size:10, weight:'bold'}, formatter: (v) => v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL', maximumFractionDigits:0 }) } }, scales: { x: { display: false }, y: { grid: { display: false } } } } });
      } catch(e){}
    }

    function renderLanca() {
      const d = runFilter(cacheSolic, filterL);
      const rows = d.map(x => `
        <tr>
          <td>#${x.numero}</td>
          <td><b>${x.colaborador}</b></td>
          <td>${x.destino}</td>
          <td>${x.placa || '-'}<br><small>${x.frota || '-'}</small></td>
          <td>${(x.dataSaida||'').split('-').reverse().join('/')}</td>
          <td><span class="pill ${x.status==='Aprovado'?'ok':(x.status==='Reprovado'?'bad':'wait')}">${x.status}</span></td>
          <td style="font-weight:800">${brl(x.valor)}</td>
          <td style="font-size:10px; max-width:150px"><i>${x.justificativa || '-'}</i></td>
          <td style="font-size:10px; color:var(--danger); max-width:150px">${x.observacao || ''}</td>
          <td>
            <div style="display:flex; gap:5px">
              <select class="input chgStatus" data-id="${x._id}" style="padding:4px; font-size:10px; width:95px">
                <option ${x.status==='Pendente'?'selected':''}>Pendente</option>
                <option ${x.status==='Aprovado'?'selected':''}>Aprovado</option>
                <option ${x.status==='Reprovado'?'selected':''}>Reprovado</option>
              </select>
              <button class="btn btn-primary" onclick="openEditLanca('${x._id}')" style="padding:5px"><i class="fa-solid fa-pen"></i></button>
            </div>
          </td>
        </tr>
      `).join('');
      $('tblLancaContainer').innerHTML = `<table><thead><tr><th>Nº</th><th>Colab</th><th>Destino</th><th>Veículo</th><th>Saída</th><th>Status</th><th>Valor</th><th>Justif. Index</th><th>Obs Auditoria</th><th>Ação</th></tr></thead><tbody>${rows || '<tr><td colspan="10">Vazio.</td></tr>'}</tbody></table>`;
      document.querySelectorAll('.chgStatus').forEach(s => { s.onchange = async () => { if(s.value==='Reprovado') openEditLanca(s.dataset.id, true); else await db.collection('solicitacoes_diaria').doc(s.dataset.id).update({status:s.value}); }; });
    }

    function renderHE(){
      const d = runFilterHE(cacheHE, filterHE);
      $('kheTotal').textContent = d.length;
      const totalMinutosGeral = d.reduce((s, x) => s + (parseInt(x.duracaoMinutos) || 0), 0);
      $('kheAprov').textContent = formatHours(totalMinutosGeral);
      $('khePend').textContent = d.filter(x => (x.status||'Pendente') === 'Pendente').length;
      
      const map = {};
      d.forEach(x=>{
        const c = x.colaborador || '-';
        if(!map[c]) map[c] = { c, a:0, b:0, c31:0, totalMin:0 };
        const faixa = x.faixaMinutos;
        if(faixa==='10-15') map[c].a++;
        if(faixa==='16-30') map[c].b++;
        if(faixa==='31-60') map[c].c31++;
        map[c].totalMin += (parseInt(x.duracaoMinutos) || 0);
      });
      
      const arr = Object.values(map).sort((p,q)=>q.totalMin - p.totalMin);
      const rows = arr.map((r,i)=>`<tr><td>${i+1}º</td><td><b>${r.c}</b></td><td style="text-align:center">${r.a}</td><td style="text-align:center">${r.b}</td><td style="text-align:center">${r.c31}</td><td style="text-align:right; font-weight:900">${formatHours(r.totalMin)}</td></tr>`).join('');
      $('heRankTbl').innerHTML = `<table><thead><tr><th style="width:40px">POS</th><th>COLABORADOR</th><th style="text-align:center">10-15</th><th style="text-align:center">16-30</th><th style="text-align:center">31-60</th><th style="text-align:right">TOTAL HORAS</th></tr></thead><tbody>${rows || '<tr><td colspan="6">Sem dados</td></tr>'}</tbody></table>`;
      
      const tipoMap = {};
      const faixaMap = { '10-15':0, '16-30':0, '31-60':0 };
      d.forEach(x=>{
        tipoMap[x.tipoHoraExtra] = (tipoMap[x.tipoHoraExtra]||0) + 1;
        if(x.faixaMinutos in faixaMap) faixaMap[x.faixaMinutos]++;
      });
      
      try{
        if(window._heTipoChart) window._heTipoChart.destroy();
        if(window._heFaixaChart) window._heFaixaChart.destroy();
        window._heTipoChart = new Chart($('heChartTipo'), { type:'doughnut', data:{ labels:Object.keys(tipoMap), datasets:[{ data:Object.values(tipoMap), backgroundColor:['#1D4ED8','#0EA5E9','#10B981','#F59E0B','#EF4444'], borderWidth:0 }]}, options:{ maintainAspectRatio:false, plugins:{ legend:{ position:'right' }, datalabels:{ color:'#fff', font:{weight:'bold'} } } } });
        window._heFaixaChart = new Chart($('heChartFaixa'), { type:'doughnut', data:{ labels:['10-15','16-30','31-60'], datasets:[{ data:[faixaMap['10-15'], faixaMap['16-30'], faixaMap['31-60']], backgroundColor:['#22c55e','#f59e0b','#ef4444'], borderWidth:0 }]}, options:{ maintainAspectRatio:false, plugins:{ legend:{ position:'right' }, datalabels:{ color:'#fff', font:{weight:'bold'} } } } });
      } catch(e){}
    }

    function renderHELista(){
      const d = runFilterHEList(cacheHE, filterHEList);
      const rows = d.map(x=>`
        <tr>
          <td>#${x.numero||''}</td>
          <td><b>${x.colaborador}</b></td>
          <td>${(x.data||'').split('-').reverse().join('/')}</td>
          <td>${x.acionadoPor||''}</td>
          <td>${x.autorizadoSupervisor||''}</td>
          <td>${x.horaInicio} – ${x.horaFim}</td>
          <td><b>${x.duracaoMinutos} min</b></td>
          <td><span class="pill ${x.status==='Aprovado'?'ok':(x.status==='Reprovado'?'bad':'wait')}">${x.status||'Pendente'}</span></td>
          <td style="font-size:10px; max-width:180px"><i>${x.justificativa || '-'}</i></td>
          <td style="font-size:10px; color:var(--danger); max-width:180px">${x.observacao || ''}</td>
          <td>
            <select class="input heChgStatus" data-id="${x._id}" style="padding:4px; font-size:10px; width:110px">
              <option ${x.status==='Pendente'?'selected':''}>Pendente</option>
              <option ${x.status==='Aprovado'?'selected':''}>Aprovado</option>
              <option ${x.status==='Reprovado'?'selected':''}>Reprovado</option>
            </select>
          </td>
        </tr>
      `).join('');
      $('heListaTbl').innerHTML = `<table><thead><tr><th>Nº</th><th>Colab</th><th>Data</th><th>Acionado</th><th>Autorizado</th><th>Período</th><th>Min</th><th>Status</th><th>Justif. Index</th><th>Obs Auditoria</th><th>Ação</th></tr></thead><tbody>${rows || '<tr><td colspan="11">Vazio</td></tr>'}</tbody></table>`;
      document.querySelectorAll('.heChgStatus').forEach(s => { s.onchange = async () => { if(s.value === 'Reprovado') openEditHE(s.dataset.id); else await db.collection('solicitacoes_hora_extra').doc(s.dataset.id).update({ status: s.value }); }; });
    }

    function populateFilters() {
      const nomes = [...new Set(cacheSolic.map(d => d.colaborador).filter(Boolean))].sort();
      const sel = $('lFiltroColab'); sel.innerHTML = '<option value="">Todos os Colaboradores</option>';
      nomes.forEach(n => sel.innerHTML += `<option value="${n}">${n}</option>`);
    }

    function populateHEFilters() {
      const nomes = [...new Set(cacheHE.map(d => d.colaborador).filter(Boolean))].sort();
      const sel = $('heLFiltroColab'); sel.innerHTML = '<option value="">Todos os Colaboradores</option>';
      nomes.forEach(n => sel.innerHTML += `<option value="${n}">${n}</option>`);
    }

    $('btnAplicaDash').onclick = () => { filterD.ini = $('dFiltroIni').value; filterD.fim = $('dFiltroFim').value; filterD.status = $('dFiltroStatus').value; renderDash(); };
    $('btnLimpaDash').onclick = () => { ['dFiltroIni','dFiltroFim','dFiltroStatus'].forEach(id => $(id).value = ''); filterD = { ini: null, fim: null, status: '' }; renderDash(); };
    $('btnAplicaLanca').onclick = () => { filterL.ini = $('lFiltroIni').value; filterL.fim = $('lFiltroFim').value; filterL.colab = $('lFiltroColab').value; renderLanca(); };
    $('btnLimpaLanca').onclick = () => { ['lFiltroIni','lFiltroFim','lFiltroColab'].forEach(id => $(id).value = ''); filterL = { ini: null, fim: null, colab: '' }; renderLanca(); };

    $('btnAplicaHE').onclick = () => {
      filterHE.ini = $('heFiltroIni').value; filterHE.fim = $('heFiltroFim').value; filterHE.status = $('heFiltroStatus').value;
      filterHE.acionado = $('heFiltroAcionado').value; filterHE.autorizado = $('heFiltroAutorizado').value;
      filterHE.tipos = Array.from($('heFiltroTipo').selectedOptions).map(o=>o.value);
      filterHE.r10 = $('heR10').checked; filterHE.r16 = $('heR16').checked; filterHE.r31 = $('heR31').checked;
      renderHE();
    };
    $('btnLimpaHE').onclick = () => { 
      ['heFiltroIni','heFiltroFim','heFiltroStatus','heFiltroAcionado','heFiltroAutorizado'].forEach(id => $(id).value=''); 
      const s=$('heFiltroTipo'); for(let i=0;i<s.options.length;i++) s.options[i].selected=false;
      ['heR10','heR16','heR31'].forEach(id => $(id).checked=true);
      filterHE = { ini: null, fim: null, tipos: [], acionado: '', autorizado: '', status:'', r10:true, r16:true, r31:true };
      renderHE();
    };

    $('btnAplicaHEList').onclick = () => {
      filterHEList.colab = $('heLFiltroColab').value; filterHEList.ini = $('heLFiltroIni').value;
      filterHEList.fim = $('heLFiltroFim').value; filterHEList.status = $('heLFiltroStatus').value;
      filterHEList.acionado = $('heLFiltroAcionado').value; filterHEList.autorizado = $('heLFiltroAutorizado').value;
      renderHELista();
    };
    $('btnLimpaHEList').onclick = () => {
      ['heLFiltroColab','heLFiltroIni','heLFiltroFim','heLFiltroStatus','heLFiltroAcionado','heLFiltroAutorizado'].forEach(id => $(id).value = '');
      filterHEList = { ini: null, fim: null, colab: '', status: '', acionado: '', autorizado: '' };
      renderHELista();
    };

    function exportToExcel(data, prefix) {
      if(!data.length) return showToast("Sem dados", false);
      const ws = XLSX.utils.json_to_sheet(data); const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Audit");
      XLSX.writeFile(wb, `${prefix}_${new Date().getTime()}.xlsx`);
    }

    $('btnExportDash').onclick = () => exportToExcel(runFilter(cacheSolic, filterD).map(x => ({ Nº: x.numero, Colab: x.colaborador, Valor: x.valor, Status: x.status, "Justif. Index": x.justificativa, "Obs Auditoria": x.observacao })), "Dash_Viagens");
    $('btnExport').onclick = () => exportToExcel(runFilter(cacheSolic, filterL).map(x => ({ Nº: x.numero, Colab: x.colaborador, Destino: x.destino, Status: x.status, "Justif. Index": x.justificativa, "Obs Auditoria": x.observacao })), "Lista_Viagens");
    $('btnExportHE').onclick = () => exportToExcel(runFilterHE(cacheHE, filterHE).map(x => ({ Nº: x.numero, Colab: x.colaborador, Duração: formatHours(x.duracaoMinutos), Status: x.status })), "BI_HE");
    $('btnExportHEList').onclick = () => exportToExcel(runFilterHEList(cacheHE, filterHEList).map(x => ({ Nº: x.numero, Colab: x.colaborador, Data: x.data, Duração: formatHours(x.duracaoMinutos), Status: x.status, "Justif. Index": x.justificativa, "Obs Auditoria": x.observacao })), "Lista_HE");

    function openEditLanca(id, reprove = false) {
      const x = cacheSolic.find(d => d._id === id);
      $('modalEdit').style.display = 'flex'; $('editTitle').textContent = reprove ? 'Reprovar #' + x.numero : 'Editar #' + x.numero;
      if(reprove) {
        $('editBody').innerHTML = `<p style="font-size:11px">Justificativa Index: <b>${x.justificativa||'-'}</b></p><textarea id="eObs" class="input" style="height:100px" placeholder="Motivo..."></textarea>`;
        $('btnSaveEdit').onclick = async () => { const obs = $('eObs').value.trim(); if(!obs) return; await db.collection('solicitacoes_diaria').doc(id).update({ status: 'Reprovado', observacao: obs }); closeEdit(); };
      } else {
        $('editBody').innerHTML = `<div><label>VALOR</label><input id="edV" type="number" step="0.01" class="input" value="${x.valor}"></div><div><label>OBS AUDITORIA</label><textarea id="edO" class="input" style="height:60px">${x.observacao||''}</textarea></div>`;
        $('btnSaveEdit').onclick = async () => { await db.collection('solicitacoes_diaria').doc(id).update({ valor: parseFloat($('edV').value), observacao: $('edO').value }); closeEdit(); };
      }
    }

    function openEditHE(id) {
      const x = cacheHE.find(d => d._id === id);
      $('modalEdit').style.display = 'flex'; $('editTitle').textContent = 'Reprovar HE #' + (x.numero||'');
      $('editBody').innerHTML = `<p style="font-size:11px">Justificativa Index: <b>${x.justificativa||'-'}</b></p><textarea id="heObs" class="input" style="height:100px" placeholder="Informe o motivo..."></textarea>`;
      $('btnSaveEdit').onclick = async () => { const obs = $('heObs').value.trim(); if(!obs) return; await db.collection('solicitacoes_hora_extra').doc(id).update({ status: 'Reprovado', observacao: obs }); closeEdit(); };
    }

    function closeEdit() { $('modalEdit').style.display = 'none'; }
    function closeSpreadsheet() { $('modalSheet').style.display = 'none'; }
    function setModo(m){
      const isV = m === 'viagem';
      $('mViagem').classList.toggle('active', isV); $('mHE').classList.toggle('active', !isV);
      document.querySelectorAll('#nav a').forEach(a => { const t = a.dataset.tab; if(['dash','lanca','mass','veic'].includes(t)) a.style.display = isV ? 'flex' : 'none'; if(['heDash','heLanca'].includes(t)) a.style.display = isV ? 'none' : 'flex'; });
      const target = isV ? document.querySelector('#nav a[data-tab="dash"]') : document.querySelector('#nav a[data-tab="heDash"]');
      if(target) target.click();
    }
    $('btnModeSwitch').onclick = () => setModo($('mViagem').classList.contains('active') ? 'he' : 'viagem');

    function renderVeiculos() {
      const rows = cacheVeic.map(v => `<tr><td><b>${v._id}</b></td><td>${v.frota || '-'}</td><td><button class="btn btn-danger" onclick="askDelete('veic','${v._id}')" style="padding:5px"><i class="fa-solid fa-trash"></i></button></td></tr>`).join('');
      $('tblVeicContainer').innerHTML = `<table><thead><tr><th>Placa</th><th>Frota</th><th>Ação</th></tr></thead><tbody>${rows || '<tr><td colspan="3">Vazio</td></tr>'}</tbody></table>`;
    }
    function askDelete(t, id) { delType = t; delId = id; $('modalConfirm').style.display = 'flex'; }
    function closeConfirm() { $('modalConfirm').style.display = 'none'; }
    $('btnDeleteConfirm').onclick = async () => { if(delType==='veic') await db.collection('veiculos').doc(delId).delete(); else await db.collection('solicitacoes_diaria').doc(delId).delete(); closeConfirm(); };
    function showToast(msg, ok=true){ const t=$('toast'); if(!t) return; t.textContent=msg; t.classList.toggle('error', !ok); t.classList.add('show'); setTimeout(()=>t.classList.remove('show'), 3000); }
    function openSpreadsheet(t) { activeSheetType = t; $('modalSheet').style.display = 'flex'; $('sheetTitle').textContent = t === 'mass' ? 'Status em Massa' : 'Gestão Frota'; addRows(50); }
    function addRows(n) { const b = $('sheetBody'); for(let i=0; i<n; i++) { const tr = document.createElement('tr'); const num = b.children.length + 1; tr.innerHTML = `<td class="row-num">${num}</td><td><div class="cell" contenteditable="true"></div></td><td><div class="cell" contenteditable="true"></div></td>`; b.appendChild(tr); } }
    $('btnSaveSheet').onclick = async () => { const rows = Array.from($('sheetBody').rows); for(let r of rows) { const v1 = r.cells[1].querySelector('div').innerText.trim(); const v2 = r.cells[2].querySelector('div').innerText.trim(); if(!v1) continue; if(activeSheetType === 'mass') { const q = await db.collection('solicitacoes_diaria').where('numero', '==', String(v1)).get(); if(!q.empty) await q.docs[0].ref.update({ status: v2 || 'Aprovado' }); } else { await db.collection('veiculos').doc(v1.toUpperCase()).set({ frota: v2 || '' }); } } closeSpreadsheet(); };
  </script>
  <div id="modalSheet" class="modal-overlay">
    <div class="modal-content">
      <div style="display:flex; justify-content:space-between; align-items:center"><h2 id="sheetTitle">Planilha</h2><button class="btn-light" onclick="closeSpreadsheet()"><i class="fa-solid fa-xmark"></i></button></div>
      <div class="spreadsheet-wrap"><table class="sheet-table" id="mainSheet"><thead id="sheetHead"><tr><th>#</th><th>Campo 1</th><th>Campo 2</th></tr></thead><tbody id="sheetBody"></tbody></table></div>
      <div style="display:flex; justify-content:space-between"><button class="btn btn-light" onclick="addRows(50)">+ 50 Linhas</button><button class="btn btn-primary" id="btnSaveSheet">Salvar Dados</button></div>
    </div>
  </div>
  <div id="toast" class="toast"></div>
</body>
</html>

